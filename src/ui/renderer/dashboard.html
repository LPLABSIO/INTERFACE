<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Bot Manager</title>
    <link rel="stylesheet" href="styles-global.css">
</head>
<body>
    <div class="app-container">
        <!-- Header unifié -->
        <header class="header page-header">
            <div class="header-content">
                <div class="header-brand">
                    <h1 class="app-title">Bot Manager</h1>
                </div>

                <nav class="header-nav">
                    <button class="nav-button" onclick="window.location.href='index.html'">
                        Principal
                    </button>
                    <button class="nav-button" data-current-page="true">
                        Dashboard
                    </button>
                    <button class="nav-button" onclick="window.location.href='analytics.html'">
                        Analytics
                    </button>
                    <button class="nav-button" onclick="window.location.href='queue-manager.html'">
                        Queue
                    </button>
                    <button class="nav-button" onclick="window.location.href='health-dashboard.html'">
                        Health
                    </button>
                </nav>

                <div class="header-actions">
                    <button id="refresh-data" class="btn btn--primary">
                        Rafraîchir
                    </button>
                    <button id="settings-btn" class="btn btn--secondary">
                        Paramètres
                    </button>
                </div>
            </div>
        </header>

        <!-- Contenu principal -->
        <main class="page-container">
            <div>
                <h2 class="page-title">Dashboard</h2>
                <p class="page-subtitle">Vue d'ensemble des sessions et performances en temps réel</p>
            </div>

            <!-- Métriques principales -->
            <div class="grid-4-cols">
                <div class="metric-card">
                    <div class="metric-card__label">Sessions Actives</div>
                    <div class="metric-card__value" id="active-sessions">0</div>
                    <div class="metric-card__change metric-card__change--positive">
                        ↑ +12% depuis hier
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-card__label">Comptes Créés</div>
                    <div class="metric-card__value" id="accounts-created">0</div>
                    <div class="metric-card__change metric-card__change--positive">
                        ↑ +8% cette semaine
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-card__label">Taux de Succès</div>
                    <div class="metric-card__value" id="success-rate">0%</div>
                    <div class="metric-card__change metric-card__change--negative">
                        ↓ -2% aujourd'hui
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-card__label">Temps Moyen</div>
                    <div class="metric-card__value" id="avg-time">0m</div>
                    <div class="metric-card__change metric-card__change--positive">
                        ↑ Optimisé de 15%
                    </div>
                </div>
            </div>

            <!-- Graphiques -->
            <div class="grid-2-cols">
                <!-- Performance Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Performance sur 7 jours</h3>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <span class="legend-dot" style="background: var(--success)"></span>
                                <span>Succès</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-dot" style="background: var(--danger)"></span>
                                <span>Échecs</span>
                            </div>
                        </div>
                    </div>
                    <canvas id="performance-chart"></canvas>
                </div>

                <!-- Device Distribution -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">Répartition des Appareils</h3>
                    </div>
                    <canvas id="device-chart"></canvas>
                </div>
            </div>

            <!-- Sessions Table -->
            <div style="margin-top: var(--space-lg);">
                <div class="action-bar">
                    <div class="action-bar__left">
                        <h3 style="color: var(--text-primary);">Sessions Récentes</h3>
                    </div>
                    <div class="action-bar__right">
                        <input type="text" class="input input--small" placeholder="Rechercher...">
                        <select class="select select--small">
                            <option>Toutes</option>
                            <option>Actives</option>
                            <option>Terminées</option>
                            <option>Échouées</option>
                        </select>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Session ID</th>
                            <th>Appareil</th>
                            <th>Application</th>
                            <th>Démarré</th>
                            <th>Durée</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sessions-table">
                        <!-- Les sessions seront ajoutées dynamiquement ici -->
                    </tbody>
                </table>
            </div>

            <!-- Activity Timeline -->
            <div class="grid-2-cols" style="margin-top: var(--space-lg);">
                <!-- Recent Activity -->
                <div>
                    <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">
                        Activité Récente
                    </h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-time">Il y a 2 min</div>
                            <div class="timeline-content">
                                <strong>Session démarrée</strong> sur iPhone X
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">Il y a 15 min</div>
                            <div class="timeline-content">
                                <strong>Compte créé</strong> avec succès
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-time">Il y a 1h</div>
                            <div class="timeline-content">
                                <strong>Session terminée</strong> - 5 comptes créés
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Health -->
                <div>
                    <h3 style="color: var(--text-primary); margin-bottom: var(--space-md);">
                        Santé du Système
                    </h3>
                    <div class="activity-list">
                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--success-light);">
                                ✓
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Appium Server</div>
                                <div class="activity-description">En cours d'exécution sur port 1265</div>
                            </div>
                            <span class="badge badge--success">EN LIGNE</span>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--success-light);">
                                ✓
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">WebDriverAgent</div>
                                <div class="activity-description">Connecté et opérationnel</div>
                            </div>
                            <span class="badge badge--success">ACTIF</span>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--warning-light);">
                                !
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Utilisation CPU</div>
                                <div class="activity-description">78% - Charge élevée détectée</div>
                            </div>
                            <span class="badge badge--warning">ATTENTION</span>
                        </div>

                        <div class="activity-item">
                            <div class="activity-icon" style="background: var(--info-light);">
                                i
                            </div>
                            <div class="activity-content">
                                <div class="activity-title">Queue Manager</div>
                                <div class="activity-description">12 tâches en attente</div>
                            </div>
                            <span class="badge badge--primary">INFO</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script>
        // Initialisation du dashboard
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Dashboard initialized');

            // Rafraîchir les données
            document.getElementById('refresh-data')?.addEventListener('click', () => {
                loadDashboardData();
            });

            // Charger les données initiales
            loadDashboardData();

            // Mise à jour automatique toutes les 30 secondes
            setInterval(loadDashboardData, 30000);
        });

        function loadDashboardData() {
            // Simulation de chargement de données
            updateMetrics();
            updateSessionsTable();
        }

        function updateMetrics() {
            // Mise à jour des métriques (simulation)
            document.getElementById('active-sessions').textContent =
                Math.floor(Math.random() * 10);
            document.getElementById('accounts-created').textContent =
                Math.floor(Math.random() * 100);
            document.getElementById('success-rate').textContent =
                Math.floor(Math.random() * 100) + '%';
            document.getElementById('avg-time').textContent =
                Math.floor(Math.random() * 60) + 'm';
        }

        function updateSessionsTable() {
            const tbody = document.getElementById('sessions-table');
            if (!tbody) return;

            // Effacer le contenu existant
            tbody.innerHTML = '';

            // Ajouter quelques sessions d'exemple
            const sessions = [
                {
                    id: 'sess_001',
                    device: 'iPhone X',
                    app: 'Hinge',
                    started: '14:30',
                    duration: '25m',
                    status: 'active'
                },
                {
                    id: 'sess_002',
                    device: 'iPhone 12',
                    app: 'Tinder',
                    started: '13:45',
                    duration: '1h 15m',
                    status: 'completed'
                },
                {
                    id: 'sess_003',
                    device: 'iPhone 11',
                    app: 'POF',
                    started: '12:00',
                    duration: '45m',
                    status: 'failed'
                }
            ];

            sessions.forEach(session => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${session.id}</td>
                    <td>${session.device}</td>
                    <td>${session.app}</td>
                    <td>${session.started}</td>
                    <td>${session.duration}</td>
                    <td>
                        <span class="badge badge--${
                            session.status === 'active' ? 'success' :
                            session.status === 'completed' ? 'primary' :
                            'danger'
                        }">
                            ${session.status.toUpperCase()}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn--small btn--ghost">Détails</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>